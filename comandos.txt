
## **2. ROTAS DA API**
```
POST   /api/v1/users/register   - Criar usuÃ¡rio (pÃºblico)
POST   /api/v1/users/login      - Login (pÃºblico)

GET    /api/v1/users            - Listar usuÃ¡rios (protegido)
GET    /api/v1/users/:id        - Buscar por ID (protegido)
PUT    /api/v1/users/:id        - Atualizar (protegido)
DELETE /api/v1/users/:id        - Deletar (protegido)
```

---

## **3. FLUXO DO PROGRAMA (Request â†’ Response)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente   â”‚
â”‚ (Insomnia)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. HTTP Request (JSON)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              index.js (Server)              â”‚
â”‚  - Inicializa Express                       â”‚
â”‚  - Conecta MongoDB                          â”‚
â”‚  - Registra middlewares globais             â”‚
â”‚  - Configura injeÃ§Ã£o de dependÃªncias        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Roteamento
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Routes (userRoutes.js)              â”‚
â”‚  - Define rotas (GET, POST, PUT, DELETE)    â”‚
â”‚  - Associa middlewares Ã s rotas             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. ValidaÃ§Ã£o
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Middlewares (validaÃ§Ã£o/autenticaÃ§Ã£o)     â”‚
â”‚  - validationMiddleware: Valida dados       â”‚
â”‚  - authMiddleware: Verifica JWT             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. OrquestraÃ§Ã£o
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Controller (UserController.js)         â”‚
â”‚  - Recebe requisiÃ§Ã£o                        â”‚
â”‚  - Chama Service adequado                   â”‚
â”‚  - Formata resposta JSON                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. LÃ³gica de NegÃ³cio
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Service (UserService.js)             â”‚
â”‚  - Valida email Ãºnico                       â”‚
â”‚  - Hash de senha (bcrypt)                   â”‚
â”‚  - Gera JWT                                 â”‚
â”‚  - Aplica regras de negÃ³cio                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. PersistÃªncia
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DAO (UserDAO.js)                   â”‚
â”‚  - Abstrai acesso ao MongoDB                â”‚
â”‚  - CRUD: create, findByEmail, findAll, etc  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Banco de Dados
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Model (User.js) + MongoDB Atlas         â”‚
â”‚  - Schema Mongoose                          â”‚
â”‚  - ValidaÃ§Ãµes de domÃ­nio                    â”‚
â”‚  - Armazena dados                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Resposta
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ErrorMiddleware (tratamento de erros)    â”‚
â”‚  - Captura erros                            â”‚
â”‚  - Formata resposta padronizada             â”‚
â”‚  - Retorna status HTTP correto              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 9. HTTP Response (JSON)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente   â”‚
â”‚  (Resposta) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### **Passo 2: Estrutura de Pastas**
```
python_api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.py              # 1Âº - DatabaseConfig (pool MySQL)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ Cantor.py                # 2Âº - Model Cantor
â”‚   â”‚   â”œâ”€â”€ Gravadora.py             # 3Âº - Model Gravadora
â”‚   â”‚   â””â”€â”€ FeatFamoso.py            # 4Âº - Model FeatFamoso
â”‚   â”‚
â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â”œâ”€â”€ CantorDAO.py             # 5Âº - DAO Cantor (CRUD completo)
â”‚   â”‚   â”œâ”€â”€ GravadoraDAO.py          # 6Âº - DAO Gravadora (CRUD completo)
â”‚   â”‚   â””â”€â”€ FeatFamosoDAO.py         # 7Âº - DAO FeatFamoso (CRUD completo)
â”‚   â”‚
â”‚   â”œâ”€â”€ exceptions/
â”‚   â”‚   â””â”€â”€ ErrorResponse.py         # 8Âº - ExceÃ§Ã£o customizada (httpCode, message, error)
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ jwt_helper.py            # 9Âº - FunÃ§Ãµes JWT (gerar/validar tokens)
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ CantorService.py         # 10Âº - LÃ³gica de negÃ³cio Cantor
â”‚   â”‚   â”œâ”€â”€ GravadoraService.py      # 11Âº - LÃ³gica de negÃ³cio Gravadora
â”‚   â”‚   â”œâ”€â”€ FeatFamosoService.py     # 12Âº - LÃ³gica de negÃ³cio FeatFamoso
â”‚   â”‚   â””â”€â”€ AuthService.py           # 13Âº - ServiÃ§o de autenticaÃ§Ã£o/login
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ CantorController.py      # 14Âº - Endpoints REST Cantor
â”‚   â”‚   â”œâ”€â”€ GravadoraController.py   # 15Âº - Endpoints REST Gravadora
â”‚   â”‚   â”œâ”€â”€ FeatFamosoController.py  # 16Âº - Endpoints REST FeatFamoso
â”‚   â”‚   â””â”€â”€ AuthController.py        # 17Âº - Endpoints de login/registro
â”‚   â”‚
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   
â”‚   â”œ
â”‚   â”œâ”€â”€ usuario_validation.py    # â† Um para cada entidade
â”‚   â”œâ”€â”€ cantor_validation.py     # banco
â”‚   â”œâ”€â”€ gravadora_validation.py  # banco
â”‚   â”œâ”€â”€ feat_validation.py       # banco
â”‚   â”‚   â””â”€â”€ error_middleware.py  # 20Âº - Handler de ErrorResponse
â”‚   â”‚   
â”‚   â”‚
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ cantor_routes.py         # 21Âº - Rotas /cantores
â”‚       â”œâ”€â”€ gravadora_routes.py      # 22Âº - Rotas /gravadoras
â”‚       â”œâ”€â”€ featfamoso_routes.py     # 23Âº - Rotas /feats
â”‚       â””â”€â”€ auth_routes.py           # 24Âº - Rotas /auth (login/register)
â”‚
â”œâ”€â”€ .env                             # 25Âº - VariÃ¡veis de ambiente (DB, JWT_SECRET)
â”œâ”€â”€ .gitignore                       # 26Âº - Ignorar venv, .env, __pycache__
â”œâ”€â”€ requirements.txt                 # 27Âº - DependÃªncias (flask, mysql-connector-python, pyjwt)
â”œâ”€â”€ app.py                           # 28Âº - InicializaÃ§Ã£o do Flask (ÃšLTIMO ARQUIVO)
â””â”€â”€ README.md                        # DocumentaÃ§Ã£o do projeto




1- verificr se o usurio existe
2- fazer as validaÃ§Ãµes relacionadas Ã s regras de dominio
3- fazer as validaÃ§Ãµes de negÃ³cio
4- cria um objeto (model) com os dados enviados
5- envia pro crud desejado

===

Service lanÃ§a exceÃ§Ãµes, Controller formata sucessos. Erros sÃ£o capturados pelo middleware!

===

Handler = "manipulador" ou "tratador". No Flask, sÃ£o funÃ§Ãµes que capturam e tratam eventos especÃ­ficos (erros, requisiÃ§Ãµes).

===
fluxo a partir da rota
Cliente â†’ Rota (@blueprint.route)
           â†“
       JWT Middleware (valida token)
           â†“
       Cargo Middleware (valida dados)
           â†“
       Controller (formata resposta)
           â†“
       Service (regras de negÃ³cio)
           â†“
       DAO (banco de dados)
           â†“
       â† Resposta JSON


===

# ============================================
# DESENVOLVIMENTO (OPCIONAL)
# ============================================
# Para testes
pytest==7.4.3
pytest-flask==1.3.0

# Para debug e anÃ¡lise
ipython==8.18.1

# Para formataÃ§Ã£o de cÃ³digo
black==23.12.1

# Para linting
pylint==3.0.3


===

1. Erro "PooledMySQLConnection does not support context manager"
Causa: VocÃª usava with database.get_connection() mas conexÃµes de pool MySQL nÃ£o suportam o protocolo with (context manager) nativamente.
SoluÃ§Ã£o: Trocamos para try/except/finally com conn.close() manual.
2. Erro "Object of type method is not JSON serializable"
Causa: No ErrorMiddleware, vocÃª tentava serializar error.httpCode (que Ã© um mÃ©todo) em vez de chamar o mÃ©todo com error.httpCode().
SoluÃ§Ã£o: Adicionamos () para chamar o mÃ©todo.
3. Erro "ErrorResponse object has no attribute 'message'"
Causa: Conflito de nomes! VocÃª tinha:
pythonself.httpCode = httpCode  # Atributo
def httpCode(self):       # MÃ©todo com MESMO NOME
Python sobrescrevia o atributo com o mÃ©todo, causando confusÃ£o.
SoluÃ§Ã£o: Renomeamos para self._httpCode (privado) e getHttpCode() (getter), separando atributos de mÃ©todos.
4. Por que usamos getters?
Para encapsular os dados e evitar conflitos de nomes entre atributos e mÃ©todos, seguindo boas prÃ¡ticas de POO.
Resumo: Erros de design de cÃ³digo (nomes duplicados) + uso incorreto de context managers. Agora estÃ¡ correto! ğŸ‰


================


Analisando seu cÃ³digo, encontrei vÃ¡rios problemas que impedem o ID de chegar corretamente nos mÃ©todos de update e delete:

1. PROBLEMA NOS CONTROLLERS 
CantorController, GravadoraController, FeatFamosoController:

Os mÃ©todos show(), update() e destroy() NÃƒO recebem o parÃ¢metro id como argumento
VocÃª estÃ¡ usando request.view_args.get("idCantor") mas deveria receber direto como parÃ¢metro

Onde corrigir:

Linha onde define def show(self): â†’ deve ser def show(self, idCantor):
Linha onde define def update(self): â†’ deve ser def update(self, idCantor):
Linha onde define def destroy(self): â†’ deve ser def destroy(self, idCantor):


2. PROBLEMA NOS DAOs 
CantorDAO, GravadoraDAO, FeatFamosoDAO:

MÃ©todo delete() recebe objeto Cantor/Gravadora/FeatFamoso mas deveria receber apenas int (o ID)
VocÃª usa self.__database mas o atributo se chama self.db_config
Ainda estÃ¡ usando with statements que causam erro de context manager

Onde corrigir:

Linha def delete(self, cantor: Cantor) â†’ deve ser def delete(self, idCantor: int)
Linha self.__database.get_connection() â†’ deve ser self.db_config.get_connection()
Todas as linhas com with â†’ trocar por try/except/finally


3. PROBLEMA NOS SERVICES 
CantorService:

Linha onde chama self.daoCantorDependency.delete(idCantor) estÃ¡ correto
MAS o DAO espera receber um objeto, nÃ£o um ID (veja problema #2)
Linha com self.daoCantorDependency.findByNome() â†’ esse mÃ©todo NÃƒO EXISTE no DAO

Onde corrigir:

Remova a linha que chama findByNome() ou use findByField('nomeCantor', nomeCantor)


4. PROBLEMA NOS MIDDLEWARES 
Todos os middlewares (exceto UsuarioMiddleware):

Linha @wraps estÃ¡ SEM PARÃŠNTESES â†’ deve ser @wraps(f)
VerificaÃ§Ã£o if 'IdCantor' not in kwargs: â†’ o nome estÃ¡ ERRADO, deve ser 'idCantor' (minÃºsculo)

Onde corrigir:

Linha @wraps â†’ adicione (f): @wraps(f)
Linha if 'IdCantor' not in kwargs: â†’ mude para if 'idCantor' not in kwargs:


5. PROBLEMA NOS MODELS âŒ
Cantor, Gravadora, FeatFamoso:

Construtor tem parÃ¢metros com nomes diferentes dos atributos
Exemplo: __init__(self, ..., id=None) mas nos Services vocÃª passa idCantor=...

Onde corrigir:

Padronize: ou sempre id ou sempre idCantor/idGravadora/idFeat


CHECKLIST DE CORREÃ‡Ã•ES:
Controllers:

 Adicionar parÃ¢metro id nos mÃ©todos show(), update(), destroy()
 Remover request.view_args.get()

DAOs:

 Mudar assinatura de delete() para receber int em vez de objeto
 Corrigir self.__database para self.db_config
 Remover todos os with statements
 Adicionar try/except/finally em todos os mÃ©todos

Services:

 Remover chamada a findByNome() ou implementar usando findByField()

Middlewares:

 Adicionar (f) em @wraps
 Corrigir 'IdCantor' para 'idCantor' (minÃºsculo)

Models:

 Padronizar nomes de parÃ¢metros no construtor

